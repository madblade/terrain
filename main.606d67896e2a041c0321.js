(self.webpackChunkterrain=self.webpackChunkterrain||[]).push([[179],{212:(e,t,r)=>{"use strict";r(654);var n=r(9),i=function(e){function t(e){for(var t=0,r=1779033703^e.length;t<e.length;t++)r=(r=Math.imul(r^e.charCodeAt(t),3432918353))<<13|r>>>19;return function(){return r=Math.imul(r^r>>>16,2246822507),r=Math.imul(r^r>>>13,3266489909),(r^=r>>>16)>>>0}}function r(e,t,r,n){return function(){var i=(e>>>=0)+(t>>>=0)|0;return e=t^t>>>9,t=(r>>>=0)+(r<<3)|0,r=(r=r<<21|r>>>11)+(i=i+(n=1+(n>>>=0)|0)|0)|0,(i>>>0)/4294967296}}var n=t("".concat(e,"h2g2")),i=t("".concat(e,"DouglasAdams")),s=t("".concat(e,"42")),o=r(n(),n(),n(),n()),a=r(i(),i(),i(),i()),h=r(s(),s(),s(),s());this.uniform=function(){return o()},this.random=this.uniform,this.normal=function(){for(var e=0,t=0;0===e;)e=a();for(;0===t;)t=h();var r=Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t);return(r=r/10+.5)>1||r<0?this.normal():2*r-1},this.z2=null,this.rnorm=function(){if(null!==this.z2){var e=this.z2;return this.z2=null,e}for(var t=0,r=0,n=2;n>=1;)n=(t=2*this.uniform()-1)*t+(r=2*this.uniform()-1)*r;return n=Math.sqrt(-2*Math.log(n)/n),this.z2=r*n,t*n},this.clamp=function(e,t,r){return Math.min(Math.max(e,t),r)}},s=function(e,t,r,n){if(!e||!t||!r)throw Error("Invalid argument");this.buffer=[],n=n||"terrain",this.randomGenerator=new i(n),this.mesher=e,this.fieldModifier=t,this.eroder=r};s.prototype.randomVector=function(e){var t=this.randomGenerator.rnorm();return[e*t,e*t]},s.prototype.runif=function(e,t){return e+this.randomGenerator.uniform()*(t-e)},s.prototype.generateCoast=function(e){var t=this.mesher,r=this.fieldModifier,n=this.eroder,i=t.generateGoodMesh(e.npts,e.extent);r.resetBuffer(i.tris.length),r.addSlope(i,this.randomVector(4)),r.addCone(i,this.runif(-1,-1)),r.addMountains(i,50);for(var s=0;s<10;s++)r.relax(i);r.peaky(i);var o=this.runif(0,.1);n.doErosion(i,o,5);var a=this.runif(.2,.6);return r.setSeaLevel(i,a),n.fillSinks(i),n.cleanCoast(i,3),console.log(i),i},s.prototype.generateUneroded=function(e){var t=this.mesher,r=this.fieldModifier,n=this.eroder,i=t.generateGoodMesh(e);return r.addSlope(i,this.randomVector(4)),r.addCone(i,this.runif(-1,1)),r.addMountains(i,50),r.peaky(i),n.fillSinks(i),r.setSeaLevel(i,.5),i};var o={width:1,height:1},a={extent:o,npts:16384,ncities:15,nterrs:5,fontsizes:{region:40,city:25,town:20}};function h(e){return function(){return e}}function f(e){return e[0]}function l(e){return e[1]}function u(){this._=null}function c(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function p(e,t){var r=t,n=t.R,i=r.U;i?i.L===r?i.L=n:i.R=n:e._=n,n.U=i,r.U=n,r.R=n.L,r.R&&(r.R.U=r),n.L=r}function d(e,t){var r=t,n=t.L,i=r.U;i?i.L===r?i.L=n:i.R=n:e._=n,n.U=i,r.U=n,r.L=n.R,r.L&&(r.L.U=r),n.R=r}function v(e){for(;e.L;)e=e.L;return e}u.prototype={constructor:u,insert:function(e,t){var r,n,i;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;r=e}else this._?(e=v(this._),t.P=null,t.N=e,e.P=e.L=t,r=e):(t.P=t.N=null,this._=t,r=null);for(t.L=t.R=null,t.U=r,t.C=!0,e=t;r&&r.C;)r===(n=r.U).L?(i=n.R)&&i.C?(r.C=i.C=!1,n.C=!0,e=n):(e===r.R&&(p(this,r),r=(e=r).U),r.C=!1,n.C=!0,d(this,n)):(i=n.L)&&i.C?(r.C=i.C=!1,n.C=!0,e=n):(e===r.L&&(d(this,r),r=(e=r).U),r.C=!1,n.C=!0,p(this,n)),r=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,r,n,i=e.U,s=e.L,o=e.R;if(r=s?o?v(o):s:o,i?i.L===e?i.L=r:i.R=r:this._=r,s&&o?(n=r.C,r.C=e.C,r.L=s,s.U=r,r!==o?(i=r.U,r.U=e.U,e=r.R,i.L=e,r.R=o,o.U=r):(r.U=i,i=r,e=r.R)):(n=e.C,e=r),e&&(e.U=i),!n)if(e&&e.C)e.C=!1;else{do{if(e===this._)break;if(e===i.L){if((t=i.R).C&&(t.C=!1,i.C=!0,p(this,i),t=i.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,d(this,t),t=i.R),t.C=i.C,i.C=t.R.C=!1,p(this,i),e=this._;break}}else if((t=i.L).C&&(t.C=!1,i.C=!0,d(this,i),t=i.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,p(this,t),t=i.L),t.C=i.C,i.C=t.L.C=!1,d(this,i),e=this._;break}t.C=!0,e=i,i=i.U}while(!e.C);e&&(e.C=!1)}}};const g=u;function m(e,t,r,n){var i=[null,null],s=O.push(i)-1;return i.left=e,i.right=t,r&&x(i,e,t,r),n&&x(i,t,e,n),D[e.index].halfedges.push(s),D[t.index].halfedges.push(s),i}function y(e,t,r){var n=[t,r];return n.left=e,n}function x(e,t,r,n){e[0]||e[1]?e.left===r?e[1]=n:e[0]=n:(e[0]=n,e.left=t,e.right=r)}function w(e,t,r,n,i){var s,o=e[0],a=e[1],h=o[0],f=o[1],l=0,u=1,c=a[0]-h,p=a[1]-f;if(s=t-h,c||!(s>0)){if(s/=c,c<0){if(s<l)return;s<u&&(u=s)}else if(c>0){if(s>u)return;s>l&&(l=s)}if(s=n-h,c||!(s<0)){if(s/=c,c<0){if(s>u)return;s>l&&(l=s)}else if(c>0){if(s<l)return;s<u&&(u=s)}if(s=r-f,p||!(s>0)){if(s/=p,p<0){if(s<l)return;s<u&&(u=s)}else if(p>0){if(s>u)return;s>l&&(l=s)}if(s=i-f,p||!(s<0)){if(s/=p,p<0){if(s>u)return;s>l&&(l=s)}else if(p>0){if(s<l)return;s<u&&(u=s)}return!(l>0||u<1)||(l>0&&(e[0]=[h+l*c,f+l*p]),u<1&&(e[1]=[h+u*c,f+u*p]),!0)}}}}}function b(e,t,r,n,i){var s=e[1];if(s)return!0;var o,a,h=e[0],f=e.left,l=e.right,u=f[0],c=f[1],p=l[0],d=l[1],v=(u+p)/2,g=(c+d)/2;if(d===c){if(v<t||v>=n)return;if(u>p){if(h){if(h[1]>=i)return}else h=[v,r];s=[v,i]}else{if(h){if(h[1]<r)return}else h=[v,i];s=[v,r]}}else if(a=g-(o=(u-p)/(d-c))*v,o<-1||o>1)if(u>p){if(h){if(h[1]>=i)return}else h=[(r-a)/o,r];s=[(i-a)/o,i]}else{if(h){if(h[1]<r)return}else h=[(i-a)/o,i];s=[(r-a)/o,r]}else if(c<d){if(h){if(h[0]>=n)return}else h=[t,o*t+a];s=[n,o*n+a]}else{if(h){if(h[0]<t)return}else h=[n,o*n+a];s=[t,o*t+a]}return e[0]=h,e[1]=s,!0}function M(e,t){var r=e.site,n=t.left,i=t.right;return r===i&&(i=n,n=r),i?Math.atan2(i[1]-n[1],i[0]-n[0]):(r===n?(n=t[1],i=t[0]):(n=t[0],i=t[1]),Math.atan2(n[0]-i[0],i[1]-n[1]))}function C(e,t){return t[+(t.left!==e.site)]}function k(e,t){return t[+(t.left===e.site)]}var S,T=[];function E(){c(this),this.x=this.y=this.arc=this.site=this.cy=null}function P(e){var t=e.P,r=e.N;if(t&&r){var n=t.site,i=e.site,s=r.site;if(n!==s){var o=i[0],a=i[1],h=n[0]-o,f=n[1]-a,l=s[0]-o,u=s[1]-a,c=2*(h*u-f*l);if(!(c>=-j)){var p=h*h+f*f,d=l*l+u*u,v=(u*p-f*d)/c,g=(h*d-l*p)/c,m=T.pop()||new E;m.arc=e,m.site=i,m.x=v+o,m.y=(m.cy=g+a)+Math.sqrt(v*v+g*g),e.circle=m;for(var y=null,x=U._;x;)if(m.y<x.y||m.y===x.y&&m.x<=x.x){if(!x.L){y=x.P;break}x=x.L}else{if(!x.R){y=x;break}x=x.R}U.insert(y,m),y||(S=m)}}}}function R(e){var t=e.circle;t&&(t.P||(S=t.N),U.remove(t),T.push(t),c(t),e.circle=null)}var A=[];function B(){c(this),this.edge=this.site=this.circle=null}function I(e){var t=A.pop()||new B;return t.site=e,t}function L(e){R(e),_.remove(e),A.push(e),c(e)}function N(e){var t=e.circle,r=t.x,n=t.cy,i=[r,n],s=e.P,o=e.N,a=[e];L(e);for(var h=s;h.circle&&Math.abs(r-h.circle.x)<V&&Math.abs(n-h.circle.cy)<V;)s=h.P,a.unshift(h),L(h),h=s;a.unshift(h),R(h);for(var f=o;f.circle&&Math.abs(r-f.circle.x)<V&&Math.abs(n-f.circle.cy)<V;)o=f.N,a.push(f),L(f),f=o;a.push(f),R(f);var l,u=a.length;for(l=1;l<u;++l)f=a[l],h=a[l-1],x(f.edge,h.site,f.site,i);h=a[0],(f=a[u-1]).edge=m(h.site,f.site,null,i),P(h),P(f)}function z(e){for(var t,r,n,i,s=e[0],o=e[1],a=_._;a;)if((n=G(a,o)-s)>V)a=a.L;else{if(!((i=s-F(a,o))>V)){n>-V?(t=a.P,r=a):i>-V?(t=a,r=a.N):t=r=a;break}if(!a.R){t=a;break}a=a.R}!function(e){D[e.index]={site:e,halfedges:[]}}(e);var h=I(e);if(_.insert(t,h),t||r){if(t===r)return R(t),r=I(t.site),_.insert(h,r),h.edge=r.edge=m(t.site,h.site),P(t),void P(r);if(r){R(t),R(r);var f=t.site,l=f[0],u=f[1],c=e[0]-l,p=e[1]-u,d=r.site,v=d[0]-l,g=d[1]-u,y=2*(c*g-p*v),w=c*c+p*p,b=v*v+g*g,M=[(g*w-p*b)/y+l,(c*b-v*w)/y+u];x(r.edge,f,d,M),h.edge=m(f,e,null,M),r.edge=m(e,d,null,M),P(t),P(r)}else h.edge=m(t.site,h.site)}}function G(e,t){var r=e.site,n=r[0],i=r[1],s=i-t;if(!s)return n;var o=e.P;if(!o)return-1/0;var a=(r=o.site)[0],h=r[1],f=h-t;if(!f)return a;var l=a-n,u=1/s-1/f,c=l/f;return u?(-c+Math.sqrt(c*c-2*u*(l*l/(-2*f)-h+f/2+i-s/2)))/u+n:(n+a)/2}function F(e,t){var r=e.N;if(r)return G(r,t);var n=e.site;return n[1]===t?n[0]:1/0}var _,D,U,O,V=1e-6,j=1e-12;function H(e,t){return t[1]-e[1]||t[0]-e[0]}function q(e,t){var r,n,i,s=e.sort(H).pop();for(O=[],D=new Array(e.length),_=new g,U=new g;;)if(i=S,s&&(!i||s[1]<i.y||s[1]===i.y&&s[0]<i.x))s[0]===r&&s[1]===n||(z(s),r=s[0],n=s[1]),s=e.pop();else{if(!i)break;N(i.arc)}if(function(){for(var e,t,r,n,i=0,s=D.length;i<s;++i)if((e=D[i])&&(n=(t=e.halfedges).length)){var o=new Array(n),a=new Array(n);for(r=0;r<n;++r)o[r]=r,a[r]=M(e,O[t[r]]);for(o.sort((function(e,t){return a[t]-a[e]})),r=0;r<n;++r)a[r]=t[o[r]];for(r=0;r<n;++r)t[r]=a[r]}}(),t){var o=+t[0][0],a=+t[0][1],h=+t[1][0],f=+t[1][1];!function(e,t,r,n){for(var i,s=O.length;s--;)b(i=O[s],e,t,r,n)&&w(i,e,t,r,n)&&(Math.abs(i[0][0]-i[1][0])>V||Math.abs(i[0][1]-i[1][1])>V)||delete O[s]}(o,a,h,f),function(e,t,r,n){var i,s,o,a,h,f,l,u,c,p,d,v,g=D.length,m=!0;for(i=0;i<g;++i)if(s=D[i]){for(o=s.site,a=(h=s.halfedges).length;a--;)O[h[a]]||h.splice(a,1);for(a=0,f=h.length;a<f;)d=(p=k(s,O[h[a]]))[0],v=p[1],u=(l=C(s,O[h[++a%f]]))[0],c=l[1],(Math.abs(d-u)>V||Math.abs(v-c)>V)&&(h.splice(a,0,O.push(y(o,p,Math.abs(d-e)<V&&n-v>V?[e,Math.abs(u-e)<V?c:n]:Math.abs(v-n)<V&&r-d>V?[Math.abs(c-n)<V?u:r,n]:Math.abs(d-r)<V&&v-t>V?[r,Math.abs(u-r)<V?c:t]:Math.abs(v-t)<V&&d-e>V?[Math.abs(c-t)<V?u:e,t]:null))-1),++f);f&&(m=!1)}if(m){var x,w,b,M=1/0;for(i=0,m=null;i<g;++i)(s=D[i])&&(b=(x=(o=s.site)[0]-e)*x+(w=o[1]-t)*w)<M&&(M=b,m=s);if(m){var S=[e,t],T=[e,n],E=[r,n],P=[r,t];m.halfedges.push(O.push(y(o=m.site,S,T))-1,O.push(y(o,T,E))-1,O.push(y(o,E,P))-1,O.push(y(o,P,S))-1)}}for(i=0;i<g;++i)(s=D[i])&&(s.halfedges.length||delete D[i])}(o,a,h,f)}this.edges=O,this.cells=D,_=U=O=D=null}q.prototype={constructor:q,polygons:function(){var e=this.edges;return this.cells.map((function(t){var r=t.halfedges.map((function(r){return C(t,e[r])}));return r.data=t.site.data,r}))},triangles:function(){var e=[],t=this.edges;return this.cells.forEach((function(r,n){if(s=(i=r.halfedges).length)for(var i,s,o,a,h,f,l=r.site,u=-1,c=t[i[s-1]],p=c.left===l?c.right:c.left;++u<s;)o=p,p=(c=t[i[u]]).left===l?c.right:c.left,o&&p&&n<o.index&&n<p.index&&(h=o,f=p,((a=l)[0]-f[0])*(h[1]-a[1])-(a[0]-h[0])*(f[1]-a[1])<0)&&e.push([l.data,o.data,p.data])})),e},links:function(){return this.edges.filter((function(e){return e.right})).map((function(e){return{source:e.left.data,target:e.right.data}}))},find:function(e,t,r){for(var n,i,s=this,o=s._found||0,a=s.cells.length;!(i=s.cells[o]);)if(++o>=a)return null;var h=e-i.site[0],f=t-i.site[1],l=h*h+f*f;do{i=s.cells[n=o],o=null,i.halfedges.forEach((function(r){var n=s.edges[r],a=n.left;if(a!==i.site&&a||(a=n.right)){var h=e-a[0],f=t-a[1],u=h*h+f*f;u<l&&(l=u,o=a.index)}}))}while(null!==o);return s._found=n,null==r||l<=r*r?i.site:null}};var W=function(){this.buffer=[],this.randomGenerator=new i("mesher")};function Y(e,t){for(var r=e.length,n=0,i=0,s=0;s<r;++s)n+=t[e[s]],++i;return n/i}function J(e){for(var t,r=1/0,n=0,i=e.length;n<i;++n)(t=e[n])<r&&(r=t);return r}function K(e){for(var t,r=-1/0,n=0,i=e.length;n<i;++n)(t=e[n])>r&&(r=t);return r}function X(e,t){for(var r,n=1/0,i=0,s=1,o=e.length;s<o;++s)r=e[s],(0===i?0===t(r,r):t(r,n)<0)&&(n=r,i=s);return i}W.prototype.generatePoints=function(e,t){t=t||o;for(var r=[],n=this.randomGenerator,i=0;i<e;i++){var s=n.uniform(),a=n.uniform();r.push([(s-.5)*t.width,(a-.5)*t.height])}return r},W.prototype.centroid=function(e){for(var t=0,r=0,n=0;n<e.length;n++)t+=e[n][0],r+=e[n][1];return[t/e.length,r/e.length]},W.prototype.improvePoints=function(e,t,r){t=t||1,r=r||o;for(var n=0;n<t;n++)e=this.voronoi(e,r).polygons(e).map(this.centroid);return e},W.prototype.generateGoodPoints=function(e,t){t=t||o;var r=this.generatePoints(e,t);return r=r.sort((function(e,t){return e[0]-t[0]})),this.improvePoints(r,1,t)},W.prototype.voronoi=function(e,t){var r=(t=t||o).width/2,n=t.height/2;return function(){var e=f,t=l,r=null;function n(n){return new q(n.map((function(r,i){var s=[Math.round(e(r,i,n)/V)*V,Math.round(t(r,i,n)/V)*V];return s.index=i,s.data=r,s})),r)}return n.polygons=function(e){return n(e).polygons()},n.links=function(e){return n(e).links()},n.triangles=function(e){return n(e).triangles()},n.x=function(t){return arguments.length?(e="function"==typeof t?t:h(+t),n):e},n.y=function(e){return arguments.length?(t="function"==typeof e?e:h(+e),n):t},n.extent=function(e){return arguments.length?(r=null==e?null:[[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]],n):r&&[[r[0][0],r[0][1]],[r[1][0],r[1][1]]]},n.size=function(e){return arguments.length?(r=null==e?null:[[0,0],[+e[0],+e[1]]],n):r&&[r[1][0]-r[0][0],r[1][1]-r[0][1]]},n}().extent([[-r,-n],[r,n]])(e)},W.prototype.makeMesh=function(e,t){t=t||o;for(var r=this.voronoi(e,t),n=[],i=new Map,s=[],a=[],h=[],f=r.edges,l=0;l<f.length;l++){var u=f[l];if(void 0!==u){var c=i.get(u[0]),p=i.get(u[1]);void 0===c&&(c=n.length,i.set(u[0],c),n.push(u[0])),void 0===p&&(p=n.length,i.set(u[1],p),n.push(u[1])),s[c]=s[c]||[],s[c].push(p),s[p]=s[p]||[],s[p].push(c);var d=u.left,v=u.right;a.push([c,p,d,v]),h[c]=h[c]||[],h[c].includes(d)||h[c].push(d),v&&!h[c].includes(v)&&h[c].push(v),h[p]=h[p]||[],h[p].includes(d)||h[p].push(d),v&&!h[p].includes(v)&&h[p].push(v)}}for(var g=n.length,m=t.width/2,y=t.height/2,x=[-m,-y],w=[m,-y],b=[-m,y],M=[m,y],C=0;C<h.length;++C){var k=s[C];if(k.length&&3!==k.length){var S=h[C];if(2===k.length){if(2!==S.length)continue;var T=S[0],E=S[1],P=S[2],R=void 0!==T?T:E,A=void 0!==T&&void 0!==E?E:P,B=(R[0]+A[0])/2,I=(R[1]+A[1])/2,L=void 0,N=void 0,z=void 0,G=void 0,F=n.length,_=n.length+1;Math.abs(B)>Math.abs(I)?B>0?(L=[m,R[1]],N=[m,A[1]],Math.max(R[1],A[1])>x[1]&&(x[1]=Math.max(R[1],A[1])),Math.min(R[1],A[1])<b[1]&&(b[1]=Math.min(R[1],A[1])),(z=[R,A,[L[0],L[1]]])[2].index=F,(G=[A,z[2],[N[0],N[1]]])[2].index=_):(L=[-m,R[1]],N=[-m,A[1]],Math.max(R[1],A[1])>w[1]&&(w[1]=Math.max(R[1],A[1])),Math.min(R[1],A[1])<M[1]&&(M[1]=Math.min(R[1],A[1])),(z=[R,A,[L[0],L[1]]])[2].index=F,(G=[A,z[2],[N[0],N[1]]])[2].index=_):I>0?(L=[R[0],y],N=[A[0],y],Math.max(R[0],A[0])>x[0]&&(x[0]=Math.max(R[0],A[0])),Math.min(R[0],A[0])<w[0]&&(w[0]=Math.min(R[0],A[0])),(z=[R,A,[L[0],L[1]]])[2].index=F,(G=[A,z[2],[N[0],N[1]]])[2].index=_):(L=[R[0],-y],N=[A[0],-y],Math.max(R[0],A[0])>b[0]&&(b[0]=Math.max(R[0],A[0])),Math.min(R[0],A[0])<M[0]&&(M[0]=Math.min(R[0],A[0])),(z=[R,A,[L[0],L[1]]])[2].index=F,(G=[A,z[2],[N[0],N[1]]])[2].index=_),n.push(L),h.push(z),s.push([]),n.push(N),h.push(G),s.push([])}}}function D(e,t,r,i){var o=[e,t,r],a=[t,r,i];n.push(e),h.push(o),s.push([]),n.push(i),h.push(a),s.push([])}var U=[x[0],x[1]],O=[x[0],y],V=[m,x[1]],j=[m,y];D(U,O,V,j),D(U=[b[0],b[1]],O=[b[0],-y],V=[m,b[1]],j=[m,-y]),D(U=[M[0],M[1]],O=[M[0],-y],V=[-m,M[1]],j=[-m,-y]),D(U=[w[0],w[1]],O=[w[0],y],V=[-m,w[1]],j=[-m,y]);for(var H=new Map,q=0,W=[],Y=0;Y<h.length;++Y){var J=h[Y],K=[];if(3===J.length)for(var X=0;X<3;++X){var Z=J[X],$="".concat(Z[0].toFixed(5),",").concat(Z[1].toFixed(5)),Q=H.get($);void 0!==Q?K.push(Q):(K.push(q),H.set($,q),q++)}W.push(K)}var ee={vor:r,pts:e,edges:a,extent:t,vxs:n,adj:s,tris:h,triPointIndexes:W,nbTriPointIndexes:q,nbInteriorTris:g},te=n.length;return te===s.length&&te===h.length||console.error("Incompatible mesh."),ee.buffer=new Array(te),console.log(ee),ee},W.prototype.generateGoodMesh=function(e,t){t=t||o;var r=this.generateGoodPoints(e,t);return this.makeMesh(r,t)},W.prototype.mergeSegments=function(e){for(var t=new Map,r=e.length,n=0;n<r;n++){var i=e[n],s=t.get(i[0])||[],o=t.get(i[1])||[];s.push(i[1]),o.push(i[0]),t.set(i[0],s),t.set(i[1],o)}for(var a=new Uint8Array(r),h=[],f=null;;){if(null===f){for(var l=0;l<r;l++)if(!a[l]){a[l]=1,f=[e[l][0],e[l][1]];break}if(null===f)break}for(var u=!1,c=0;c<r;c++)if(!a[c]){var p=t.get(f[0]),d=t.get(f[f.length-1]);if(p&&2===p.length&&e[c][0]===f[0])f.unshift(e[c][1]);else if(p&&2===p.length&&e[c][1]===f[0])f.unshift(e[c][0]);else if(d&&2===d.length&&e[c][0]===f[f.length-1])f.push(e[c][1]);else{if(!d||2!==d.length||e[c][1]!==f[f.length-1])continue;f.push(e[c][0])}a[c]=1,u=!0;break}u||(h.push(f),f=null)}return h},W.prototype.contour=function(e,t){var r=e.edges,n=e.buffer;t=t||0;for(var i=[],s=0;s<r.length;s++){var o=r[s];void 0!==o[3]&&(this.isnearedge(e,o[0])||this.isnearedge(e,o[1])||(n[o[0]]>t&&n[o[1]]<=t||n[o[1]]>t&&n[o[0]]<=t)&&i.push([o[2],o[3]]))}return this.mergeSegments(i)},W.prototype.isedge=function(e,t){return e.adj[t].length<3},W.prototype.inef=function(e,t,r){var n=e[0],i=e[1];return n<-.45*t||n>.45*t||i<-.45*r||i>.45*r},W.prototype.isnearedge=function(e,t){var r=e.vxs[t][0],n=e.vxs[t][1],i=e.extent.width,s=e.extent.height;return r<-.45*i||r>.45*i||n<-.45*s||n>.45*s},W.prototype.neighboursCopy=function(e,t){for(var r=e.adj[t],n=[],i=0;i<r.length;i++)n.push(r[i]);return n},W.prototype.neighbours=function(e,t){return e.adj[t]},W.prototype.distance=function(e,t,r){var n=e.vxs[t],i=e.vxs[r];return Math.sqrt(Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2))},r(666);var Z=function(e,t){if(!e)throw Error("Invalid argument");this.buffer=[],t=t||"rough",this.randomGenerator=new i(t),this.mesher=e,this.nbMountains=0};Z.prototype.resetBuffer=function(e){this.buffer.length!==e?this.buffer=new Float64Array(e):this.buffer.fill(0)},Z.prototype.swapBuffers=function(e){var t=this.buffer;this.buffer=e.buffer,e.buffer=t},Z.prototype.addScalar=function(e,t,r){for(var n=0,i=t.length;n<i;n++)t[n]+=r},Z.prototype.apply1D=function(e,t,r){for(var n=0,i=t.length;n<i;n++){var s=t[n];t[n]=r(s)}},Z.prototype.apply2D=function(e,t,r){for(var n,i=e.vxs,s=0,o=i.length;s<o;s++)n=i[s],t[s]=r(n)},Z.prototype.addSlope=function(e,t,r,n){for(var i,s=e.vxs,o=r%2==0?.5:-.5,a=n%2==0?.5:-.5,h=0,f=s.length;h<f;h++)i=s[h],t[h]+=Math.sqrt(Math.pow(i[0]-o,2)+Math.pow(i[1]-a,2))},Z.prototype.addCone=function(e,t,r){this.apply2D(e,t,(function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))*r}))},Z.prototype.resetField=function(e){for(var t=e.buffer,r=0,n=t.length;r<n;++r)t[r]=0},Z.prototype.addMountains=function(e,t,r,n){var i=this.randomGenerator;n=n||.05;for(var s=[],o=0;o<r;o++){var a=i.uniform(),h=i.uniform();s.push([e.extent.width*(a-.5)*.85,e.extent.height*(h-.5)*.85])}for(var f=e.vxs,l=1/(2*n*n),u=f.length,c=0;c<u;c++)for(var p=f[c],d=p[0],v=p[1],g=0;g<r;g++){var m=s[g],y=d-m[0],x=v-m[1];t[c]+=Math.pow(Math.exp(-(Math.pow(y,2)+Math.pow(x,2))*l),2)}this.nbMountains+=r},Z.prototype.normalize=function(e,t){var r=J(t),n=K(t);this.apply1D(e,t,(function(e){return(e-r)/(n-r)}))},Z.prototype.peaky=function(e,t){this.normalize(e,t),this.apply1D(e,t,Math.sqrt)},Z.prototype.relax=function(e,t){var r=this.mesher,n=t.buffer,i=n.length;this.resetBuffer(i);for(var s=this.buffer,o=0;o<i;o++){var a=r.neighbours(e,o);a.length<3?s[o]=n[o]:s[o]=Y(a,n)}this.swapBuffers(t)},Z.prototype.setSeaLevel=function(e,t,r){this.addScalar(e,t,-.3)};var $=Object.freeze({WAITING:-1,ERODING:3,FILLING_SINKS:4,READY:5,GETTING_FLUX:0,GETTING_SLOPE:1,COMPUTING_RATE:2}),Q=function(e){if(!e)throw Error("Invalid argument");this.buffer=[],this.fluxBuffer=[],this.slopeBuffer=[],this.indexBuffer=[],this.downhillBuffer=[],this.mesher=e,this.amount=0,this.step=-1,this.erosionPass=0,this.doneFillingSinks=!1,this.isFillingSinks=!1,this.cleanCoastPass=0,this.cleanCoastPStep=0,this.doAllAtOnce=!1};Q.prototype.setErosionAmount=function(e){this.amount=e},Q.prototype.stepErosion=function(e,t,r){var n=this.amount;switch(this.step){case $.WAITING:this.fillSinks(e,t),this.doneFillingSinks&&(this.step=$.ERODING);break;case $.FILLING_SINKS:this.fillSinks(e,t),this.doneFillingSinks&&(this.erosionPass++,this.erosionPass>=r?this.step=$.READY:this.step=$.ERODING);break;case $.ERODING:this.erode(e,t,n),this.doneFillingSinks=!1,this.isFillingSinks=!1,this.step=$.FILLING_SINKS;break;case $.READY:this.doneFillingSinks=!1,this.isFillingSinks=!1,this.ready=!0}},Q.prototype.doErosion=function(e,t,r,n){n=n||1,this.fillSinks(e,t);for(var i=0;i<n;i++)this.erode(e,r),this.fillSinks(e,t)},Q.prototype.resetDownhillBuffer=function(e){this.downhillBuffer.length!==e?this.downhillBuffer=new Int32Array(e):this.downhillBuffer.fill(0)},Q.prototype.resetSlopeBuffer=function(e){this.slopeBuffer.length!==e?this.slopeBuffer=new Float64Array(e):this.slopeBuffer.fill(0)},Q.prototype.resetFluxBuffer=function(e){this.fluxBuffer.length!==e?this.fluxBuffer=new Float64Array(e):this.fluxBuffer.fill(0)},Q.prototype.resetIndexBuffer=function(e){this.indexBuffer.length!==e?this.indexBuffer=new Float64Array(e):this.indexBuffer.fill(0)},Q.prototype.resetBuffer=function(e){this.buffer.length!==e?this.buffer=new Float64Array(e):this.buffer.fill(0)},Q.prototype.swapBuffers=function(e){var t=this.buffer;this.buffer=e.buffer,e.buffer=t},Q.prototype.downhill=function(e,t){var r=t.buffer.length;this.resetDownhillBuffer(r);for(var n=this.downhillBuffer,i=0;i<r;i++)n[i]=this.downfrom(e,t,i);return n},Q.prototype.downfrom=function(e,t,r){var n=this.mesher;if(n.isedge(e,r))return-2;for(var i=t.buffer,s=-1,o=i[r],a=n.neighbours(e,r),h=0,f=a.length;h<f;h++){var l=a[h],u=i[l];u<o&&(o=u,s=l)}return s},Q.prototype.topologicalFill=function(e,t){for(var r=this.mesher,n=t.buffer,i=n.length,s=[],o=0;o<i;++o){var a=r.neighbours(e,o);if(!(a.length<3)){var h=n[o];n[a[0]]>h&&n[a[1]]>h&&n[a[2]]>h&&s.push(o)}}for(;s.length;){var f=s.pop(),l=r.neighbours(e,f),u=l[0],c=n[u],p=l[1],d=n[p],v=l[2],g=n[v],m=void 0;c<=d&&c<=g?m=c:d<=c&&d<=g?m=d:m=g,n[f]=m+1e-5;var y=r.neighbours(e,u);3===y.length&&n[y[0]]>c&&n[y[1]]>c&&n[y[2]]>c&&s.push(u),3===(y=r.neighbours(e,p)).length&&n[y[0]]>d&&n[y[1]]>d&&n[y[2]]>d&&s.push(p),3===(y=r.neighbours(e,v)).length&&n[y[0]]>g&&n[y[1]]>g&&n[y[2]]>g&&s.push(v)}},Q.prototype.fillSinks=function(e,t,r){var n=this.mesher,i=t.buffer;r=r||1e-5;var s,o=i.length;if(!this.isFillingSinks){this.resetBuffer(o),s=this.buffer;for(var a=0;a<o;++a)n.isnearedge(e,a)?s[a]=i[a]:s[a]=1/0;this.isFillingSinks=!0}if(s=this.buffer,this.doAllAtOnce)this.topologicalFill(e,t);else for(var h,f=window.performance.now(),l=!1;;){l=!1;for(var u=0;u<o;++u){var c=u,p=i[c];if(s[c]!==p)for(var d=n.neighbours(e,c),v=d.length,g=0;g<v;g++){if(p>=(h=s[d[g]]+r)){s[c]=p,l=!0;break}s[c]>h&&(s[c]=h,l=!0)}}if(!l)return this.doneFillingSinks=!0,this.isFillingSinks=!1,void this.swapBuffers(t);if(window.performance.now()-f>5)return}},Q.prototype.getFlux=function(e,t){var r=this.downhill(e,t),n=t.buffer.length;this.resetIndexBuffer(n),this.resetFluxBuffer(n);for(var i=this.indexBuffer,s=this.fluxBuffer,o=t.buffer,a=o.length,h=1/a,f=0;f<a;++f)i[f]=1e5*Math.floor(1e10*(1+o[f]))+f,s[f]=h;i.sort();for(var l=0;l<a;++l)i[l]%=1e5;for(var u=0;u<a;u++){var c=i[a-1-u],p=r[c];p>=0&&(s[p]+=s[c])}return s},Q.prototype.trislope=function(e,t,r){var n=this.mesher.neighbours(e,r);if(3!==n.length)return[0,0];var i=e.vxs[n[0]],s=e.vxs[n[1]],o=e.vxs[n[2]],a=s[0]-i[0],h=o[0]-i[0],f=s[1]-i[1],l=o[1]-i[1],u=a*l-h*f,c=t.buffer,p=c[n[1]]-c[n[0]],d=c[n[2]]-c[n[0]];return[(l*p-f*d)/u,(-h*p+a*d)/u]},Q.prototype.getSlope=function(e,t){this.resetSlopeBuffer(t.buffer.length);for(var r=this.slopeBuffer,n=t.buffer,i=0;i<n.length;i++){var s=this.trislope(e,t,i);r[i]=Math.sqrt(s[0]*s[0]+s[1]*s[1])}return r},Q.prototype.erosionRate=function(e,t){var r=this.getFlux(e,t),n=this.getSlope(e,t),i=t.buffer.length;this.resetBuffer(i);for(var s=this.buffer,o=0;o<i;o++){var a=Math.sqrt(r[o])*n[o]*1e3+n[o]*n[o];a=a>200?200:a,s[o]=a}return s},Q.prototype.erode=function(e,t,r){for(var n=t.buffer,i=this.erosionRate(e,t),s=r/K(i),o=n.length,a=0;a<o;a++)n[a]=n[a]-s*i[a]},Q.prototype.cleanCoastP1=function(e,t){var r,n=this.mesher,i=t.buffer,s=i.length;this.resetBuffer(s),r=this.buffer,i=t.buffer;for(var o=0;o<i.length;o++){r[o]=i[o];var a=n.neighbours(e,o);if(!(i[o]<=0||3!==a.length)){for(var h=0,f=-999999,l=0;l<a.length;l++){var u=i[a[l]];u>0?h++:u>f&&(f=u)}h>1||(r[o]=f/2)}}this.swapBuffers(t)},Q.prototype.cleanCoastP2=function(e,t){var r,n=this.mesher,i=t.buffer,s=i.length;this.resetBuffer(s),r=this.buffer,i=t.buffer;for(var o=0;o<i.length;o++){r[o]=i[o];var a=n.neighbours(e,o);if(!(i[o]>0||3!==a.length)){for(var h=0,f=999999,l=0;l<a.length;l++){var u=i[a[l]];u<=0?h++:u<f&&(f=u)}h>1||(r[o]=f/2)}}this.swapBuffers(t)},Q.prototype.cleanCoast=function(e,t){if(0===this.cleanCoastPStep){var r=window.performance.now();this.cleanCoastP1(e,t),window.performance.now()-r<3?(this.cleanCoastP2(e,t),this.cleanCoastPass++):this.cleanCoastPStep=1}else 1===this.cleanCoastPStep&&(this.cleanCoastP2(e,t),this.cleanCoastPStep=0)};var ee=r(307),te=r.n(ee),re=function(e,t,r){if(!e||!t||!r)throw Error("Invalid argument");this.buffer=[],this.fluxBuffer=[],this.mesher=e,this.fieldModifier=t,this.eroder=r,this.nbCities=0};re.prototype.resetBuffer=function(e){this.buffer.length!==e?this.buffer=new Float64Array(e):this.buffer.fill(0)},re.prototype.resetFluxBuffer=function(e){this.fluxBuffer.length!==e?this.fluxBuffer=new Float64Array(e):this.fluxBuffer.fill(0)},re.prototype.copyBuffer=function(e,t){if(e.length!==t.length)throw Error("[CityPlacer] Invalid buffer lengths.");for(var r=e.length,n=0;n<r;++n)t[n]=e[n]},re.prototype.cityScore=function(e,t,r){var n=this.eroder,i=this.mesher,s=this.fieldModifier,o=t.buffer;if(this.resetBuffer(o.length),this.fluxBuffer.length!==o.length){this.resetFluxBuffer(o.length);var a=this.fluxBuffer;this.fluxBuffer=n.getFlux(e,t),n.fluxBuffer=a}this.copyBuffer(this.fluxBuffer,this.buffer),s.apply1D(e,this.buffer,Math.sqrt);for(var h=this.buffer,f=e.extent.width/2,l=e.extent.height/2,u=0;u<o.length;u++)if(o[u]<=0||i.isnearedge(e,u))h[u]=-999999;else{h[u]+=.01/(1e-9+Math.abs(e.vxs[u][0])-f),h[u]+=.01/(1e-9+Math.abs(e.vxs[u][1])-l);for(var c=0;c<r.length;c++)h[u]-=.02/(i.distance(e,r[c],u)+1e-9)}return h},re.prototype.placeCity=function(e,t){e.cities=e.cities||[];var r=function(e){for(var t,r=-1/0,n=0,i=1,s=e.length;i<s;++i)(t=e[i])>r&&(r=t,n=i);return n}(this.cityScore(e.mesh,t,e.cities));e.cities.push(r),this.nbCities++},re.prototype.placeCities=function(e,t,r){for(var n=0;n<r;n++)this.placeCity(e,t)},re.prototype.getRivers=function(e,t,r){var n,i=this.eroder,s=this.mesher,o=i.downhill(e,t),a=t.buffer,h=e.vxs;n=this.fluxBuffer.length===a.length?this.fluxBuffer:i.getFlux(e,t);for(var f=[],l=0,u=a.length,c=0;c<u;c++)a[c]>0&&l++;r*=l/u;for(var p=o.length,d=e.extent.width,v=e.extent.height,g=0;g<p;g++){var m=h[g];if(!s.inef(m,d,v)){var y=o[g],x=a[g];if(n[g]>r&&x>0&&y>=0){var w=h[y];a[y]>0?f.push([m,w]):f.push([m,[(m[0]+w[0])/2,(m[1]+w[1])/2]])}}}return s.mergeSegments(f).map(this.relaxPath)},re.prototype.getTerritories=function(e){var t=this.eroder,r=this.mesher,n=e.mesh,i=n.buffer,s=e.cities,o=e.params.nterrs;o>e.cities.length&&(o=e.cities.length);var a=t.getFlux(n),h=[],f=new(te())({comparator:function(e,t){return e.score-t.score}});function l(e,t){var s=r.distance(n,e,t),o=i[t]-i[e];o>0&&(o/=10);var h=1+.25*Math.pow(o/s,2);return h+=100*Math.sqrt(a[e]),i[e]<=0&&(h=100),i[e]>0!=i[t]>0?1e3:s*h}for(var u=0;u<o;u++){h[s[u]]=s[u];for(var c=r.neighbours(n,s[u]),p=0;p<c.length;p++)f.queue({score:l(s[u],c[p]),city:s[u],vx:c[p]})}for(;f.length;){var d=f.dequeue();if(void 0===h[d.vx]){h[d.vx]=d.city;for(var v=r.neighbours(n,d.vx),g=0;g<v.length;g++){var m=v[g];if(void 0===h[m]){var y=l(d.vx,m);f.queue({score:d.score+y,city:d.city,vx:m})}}}}return h},re.prototype.getBorders=function(e){for(var t=this.mesher,r=e.terr,n=e.mesh,i=n.edges,s=n.buffer,o=[],a=0;a<i.length;a++){var h=i[a];void 0!==h[3]&&(t.isnearedge(n,h[0])||t.isnearedge(n,h[1])||s[h[0]]<0||s[h[1]]<0||r[h[0]]!==r[h[1]]&&o.push([h[2],h[3]]))}return t.mergeSegments(o).map(this.relaxPath)},re.prototype.relaxPath=function(e){for(var t=[e[0]],r=1;r<e.length-1;r++){var n=[.25*e[r-1][0]+.5*e[r][0]+.25*e[r+1][0],.25*e[r-1][1]+.5*e[r][1]+.25*e[r+1][1]];t.push(n)}return t.push(e[e.length-1]),t};var ne=function(e){e=e||"language",this.randomGenerator=new i(e)};ne.prototype.shuffled=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);for(var n=e.length-1;n>0;n--){var i=t[n],s=this.randrange(n);t[n]=t[s],t[s]=i}return t},ne.prototype.choose=function(e,t){t=t||1;var r=this.randomGenerator.uniform();return e[Math.floor(Math.pow(r,t)*e.length)]},ne.prototype.randrange=function(e,t){void 0===t&&(t=e,e=0);var r=this.randomGenerator.uniform();return Math.floor(r*(t-e))+e},ne.prototype.join=function(e,t){if(0===e.length)return"";t=t||"";for(var r=e[0],n=1;n<e.length;n++)r+=t,r+=e[n];return r},ne.prototype.capitalize=function(e){return e[0].toUpperCase()+e.slice(1)},ne.prototype.spell=function(e,t){if(e.noortho)return t;for(var r="",n=0;n<t.length;n++){var i=t[n];r+=e.cortho[i]||e.vortho[i]||ie[i]||i}return r},ne.prototype.makeSyllable=function(e){for(var t=this.randomGenerator;;){for(var r="",n=0;n<e.structure.length;n++){var i=e.structure[n];"?"===e.structure[n+1]&&(n++,t.uniform()<.5)||(r+=this.choose(e.phonemes[i],e.exponent))}for(var s=!1,o=0;o<e.restricts.length;o++)if(e.restricts[o].test(r)){s=!0;break}if(!s)return this.spell(e,r)}},ne.prototype.getMorpheme=function(e,t){if(e.nomorph)return this.makeSyllable(e);t=t||"";var r=e.morphemes[t]||[],n=10;for(t&&(n=1);;){var i=this.randrange(r.length+n);if(r[i])return r[i];var s=this.makeSyllable(e),o=!1;for(var a in e.morphemes)if(e.morphemes[a].includes(s)){o=!0;break}if(!o)return r.push(s),e.morphemes[t]=r,s}},ne.prototype.makeWord=function(e,t){var r=this.randrange(e.minsyll,e.maxsyll+1),n="",i=[];i[this.randrange(r)]=t;for(var s=0;s<r;s++)n+=this.getMorpheme(e,i[s]);return n},ne.prototype.getWord=function(e,t){t=t||"";var r=e.words[t]||[],n=3;for(t&&(n=2);;){var i=r[this.randrange(r.length+n)];if(i)return i;i=this.makeWord(e,t);var s=!1;for(var o in e.words)if(e.words[o].includes(i)){s=!0;break}if(!s)return r.push(i),e.words[t]=r,i}},ne.prototype.makeName=function(e,t){var r=this.randomGenerator;for(t=t||"",e.genitive=e.genitive||this.getMorpheme(e,"of"),e.definite=e.definite||this.getMorpheme(e,"the");;){var n=null;if(r.uniform()<.5)n=this.capitalize(this.getWord(e,t));else{var i=this.capitalize(this.getWord(e,r.uniform()<.6?t:"")),s=this.capitalize(this.getWord(e,r.uniform()<.6?t:""));if(i===s)continue;n=r.uniform()>.5?this.join([i,s],e.joiner):this.join([i,e.genitive,s],e.joiner)}if(r.uniform()<.1&&(n=this.join([e.definite,n],e.joiner)),!(n.length<e.minchar||n.length>e.maxchar)){for(var o=!1,a=0;a<e.names.length;a++){var h=e.names[a];if(-1!==n.indexOf(h)||-1!==h.indexOf(n)){o=!0;break}}if(!o)return e.names.push(n),n}}},ne.prototype.makeBasicLanguage=function(){return{phonemes:{C:"ptkmnls",V:"aeiou",S:"s",F:"mn",L:"rl"},structure:"CVC",exponent:2,restricts:[],cortho:{},vortho:{},noortho:!0,nomorph:!0,nowordpool:!0,minsyll:1,maxsyll:1,morphemes:{},words:{},names:[],joiner:" ",maxchar:12,minchar:5}},ne.prototype.makeOrthoLanguage=function(){var e=this.makeBasicLanguage();return e.noortho=!1,e},ne.prototype.makeRandomLanguage=function(){var e=this.makeBasicLanguage();return e.noortho=!1,e.nomorph=!1,e.nowordpool=!1,e.phonemes.C=this.shuffled(this.choose(ae,2).C),e.phonemes.V=this.shuffled(this.choose(ue,2).V),e.phonemes.L=this.shuffled(this.choose(fe,2).L),e.phonemes.S=this.shuffled(this.choose(he,2).S),e.phonemes.F=this.shuffled(this.choose(le,2).F),e.structure=this.choose(ce),e.restricts=pe[2].res,e.cortho=this.choose(se,2).orth,e.vortho=this.choose(oe,2).orth,e.minsyll=this.randrange(1,3),e.structure.length<3&&e.minsyll++,e.maxsyll=this.randrange(e.minsyll+1,7),e.joiner=this.choose("   -"),e};var ie={ʃ:"sh",ʒ:"zh",ʧ:"ch",ʤ:"j",ŋ:"ng",j:"y",x:"kh",ɣ:"gh",ʔ:"‘",A:"á",E:"é",I:"í",O:"ó",U:"ú"},se=[{name:"Default",orth:{}},{name:"Slavic",orth:{ʃ:"š",ʒ:"ž",ʧ:"č",ʤ:"ǧ",j:"j"}},{name:"German",orth:{ʃ:"sch",ʒ:"zh",ʧ:"tsch",ʤ:"dz",j:"j",x:"ch"}},{name:"French",orth:{ʃ:"ch",ʒ:"j",ʧ:"tch",ʤ:"dj",x:"kh"}},{name:"Chinese (pinyin)",orth:{ʃ:"x",ʧ:"q",ʤ:"j"}}],oe=[{name:"Ácutes",orth:{}},{name:"Ümlauts",orth:{A:"ä",E:"ë",I:"ï",O:"ö",U:"ü"}},{name:"Welsh",orth:{A:"â",E:"ê",I:"y",O:"ô",U:"w"}},{name:"Diphthongs",orth:{A:"au",E:"ei",I:"ie",O:"ou",U:"oo"}},{name:"Doubles",orth:{A:"aa",E:"ee",I:"ii",O:"oo",U:"uu"}}],ae=[{name:"Minimal",C:"ptkmnls"},{name:"English-ish",C:"ptkbdgmnlrsʃzʒʧ"},{name:"Pirahã (very simple)",C:"ptkmnh"},{name:"Hawaiian-ish",C:"hklmnpwʔ"},{name:"Greenlandic-ish",C:"ptkqvsgrmnŋlj"},{name:"Arabic-ish",C:"tksʃdbqɣxmnlrwj"},{name:"Arabic-lite",C:"tkdgmnsʃ"},{name:"English-lite",C:"ptkbdgmnszʒʧhjw"}],he=[{name:"Just s",S:"s"},{name:"s ʃ",S:"sʃ"},{name:"s ʃ f",S:"sʃf"}],fe=[{name:"r l",L:"rl"},{name:"Just r",L:"r"},{name:"Just l",L:"l"},{name:"w j",L:"wj"},{name:"r l w j",L:"rlwj"}],le=[{name:"m n",F:"mn"},{name:"s k",F:"sk"},{name:"m n ŋ",F:"mnŋ"},{name:"s ʃ z ʒ",F:"sʃzʒ"}],ue=[{name:"Standard 5-vowel",V:"aeiou"},{name:"3-vowel a i u",V:"aiu"},{name:"Extra A E I",V:"aeiouAEI"},{name:"Extra U",V:"aeiouU"},{name:"5-vowel a i u A I",V:"aiuAI"},{name:"3-vowel e o u",V:"eou"},{name:"Extra A O U",V:"aeiouAOU"}],ce=["CVC","CVV?C","CVVC?","CVC?","CV","VC","CVF","C?VC","CVF?","CL?VC","CL?VF","S?CVC","S?CVF","S?CVC?","C?VF","C?VC?","C?VF?","C?L?VC","VC","CVL?C?","C?VL?C","C?VLC?"],pe=[{name:"None",res:[]},{name:"Double sounds",res:[/(.)\1/]},{name:"Doubles and hard clusters",res:[/[sʃf][sʃ]/,/(.)\1/,/[rl][rl]/]}],de=function(e){if(!e)throw Error("Invalid argument.");this.buffer=[],this.languageGenerator=e};de.prototype.giveNames=function(e){var t=this.languageGenerator,r=t.makeRandomLanguage(),n=e.cities,i=e.terr,s=e.params.nterrs;if(n){for(var o=[],a=0;a<n.length;a++)o.push(t.makeName(r,"city"));e.cityNames=o}if(i){for(var h=[],f=0;f<s;f++)h.push(t.makeName(r,"region"));e.regionNames=h}},de.prototype.terrCenter=function(e,t,r,n){for(var i=e.buffer,s=0,o=0,a=0,h=0;h<t.length;h++)t[h]===r&&(n&&i[h]<=0||(s+=e.vxs[h][0],o+=e.vxs[h][1],a++));return[s/a,o/a]},de.prototype.drawLabels=function(e,t){this.languageGenerator;var r=t.params,n=t.mesh,i=n.buffer,s=t.terr,o=t.cities,a=t.params.nterrs,h=[t.rivers,t.coasts,t.borders],f=[],l=t.cityNames,u=t.regionNames;function c(e){var t=0;e.x0<-.45*n.extent.width&&(t+=100),e.x1>.45*n.extent.width&&(t+=100),e.y0<-.45*n.extent.height&&(t+=100),e.y1>.45*n.extent.height&&(t+=100);for(var r=0;r<f.length;r++){var i=f[r];e.x0<i.x1&&e.x1>i.x0&&e.y0<i.y1&&e.y1>i.y0&&(t+=100)}for(var s=0;s<o.length;s++){var a=n.vxs[o[s]];e.x0<a[0]&&e.x1>a[0]&&e.y0<a[1]&&e.y1>a[1]&&(t+=100)}for(var l=0;l<h.length;l++)for(var u=h[l],c=0;c<u.length;c++)for(var p=u[c],d=0;d<p.length;d++){var v=p[d];v[0]>e.x0&&v[0]<e.x1&&v[1]>e.y0&&v[1]<e.y1&&t++}return t}for(var p=0;p<o.length;p++){var d=n.vxs[o[p]][0],v=n.vxs[o[p]][1],g=l[p],m=p<a?r.fontsizes.city:r.fontsizes.town,y=.65*m/1e3*g.length,x=m/1e3,w=[{x:d+.8*x,y:v+.3*x,align:"start",x0:d+.7*x,y0:v-.6*x,x1:d+.7*x+y,y1:v+.6*x},{x:d-.8*x,y:v+.3*x,align:"end",x0:d-.9*x-y,y0:v-.7*x,x1:d-.9*x,y1:v+.7*x},{x:d,y:v-.8*x,align:"middle",x0:d-y/2,y0:v-1.9*x,x1:d+y/2,y1:v-.7*x},{x:d,y:v+1.2*x,align:"middle",x0:d-y/2,y0:v+.1*x,x1:d+y/2,y1:v+1.3*x}],b=w[X(w,(function(e,t){return c(e)-c(t)}))];b.text=g,b.size=m,f.push(b)}var M=e.selectAll("text.city").data(f);M.enter().append("text").classed("city",!0),M.exit().remove(),e.selectAll("text.city").attr("x",(function(e){return 1e3*e.x})).attr("y",(function(e){return 1e3*e.y})).style("font-size",(function(e){return e.size})).style("text-anchor",(function(e){return e.align})).text((function(e){return e.text})).raise();for(var C=[],k=0;k<a;k++){for(var S=o[k],T=u[k],E=r.fontsizes.region/1e3,P=.6*T.length*E,R=this.terrCenter(n,s,S,!0),A=this.terrCenter(n,s,S,!1),B=0,I=-999999,L=0;L<i.length;L++){var N=0,z=n.vxs[L];N-=3e3*Math.sqrt(Math.pow(z[0]-R[0],2)+Math.pow(z[1]-R[1],2)),N-=1e3*Math.sqrt(Math.pow(z[0]-A[0],2)+Math.pow(z[1]-A[1],2)),s[L]!==S&&(N-=3e3);for(var G=0;G<o.length;G++){var F=n.vxs[o[G]];Math.abs(z[0]-F[0])<P&&Math.abs(z[1]-E/2-F[1])<E&&(N-=G<a?4e3:500),z[0]-P/2<f[G].x1&&z[0]+P/2>f[G].x0&&z[1]-E<f[G].y1&&z[1]>f[G].y0&&(N-=5e3)}for(var _=0;_<C.length;_++){var D=C[_];z[0]-P/2<D.x+D.width/2&&z[0]+P/2>D.x-D.width/2&&z[1]-E<D.y&&z[1]>D.y-D.size&&(N-=2e4)}i[L]<=0&&(N-=500),z[0]+P/2>.5*n.extent.width&&(N-=5e4),z[0]-P/2<-.5*n.extent.width&&(N-=5e4),z[1]>.5*n.extent.height&&(N-=5e4),z[1]-E<-.5*n.extent.height&&(N-=5e4),N>I&&(I=N,B=L)}C.push({text:T,x:n.vxs[B][0],y:n.vxs[B][1],size:E,width:P})}(M=e.selectAll("text.region").data(C)).enter().append("text").classed("region",!0),M.exit().remove(),e.selectAll("text.region").attr("x",(function(e){return 1e3*e.x})).attr("y",(function(e){return 1e3*e.y})).style("font-size",(function(e){return 1e3*e.size})).style("text-anchor","middle").text((function(e){return e.text})).raise()};var ve=r(886),ge=r(610),me=ge.td_,ye=ge.Vaf,xe=ge.ETc,we=function(e,t,r,n,i){this.mesher=e,this.eroder=t,this.terrainGenerator=r,this.cityPlacer=n,this.nameGiver=i};we.prototype.visualizePoints=function(e,t){var r=e.selectAll("circle.vtest").data(t);r.enter().append("circle").classed("vtest",!0),r.exit().remove(),me("circle.vtest").attr("cx",(function(e){return 1e3*e[0]})).attr("cy",(function(e){return 1e3*e[1]})).attr("r",100/Math.sqrt(t.length))},we.prototype.makeD3Path=function(e){var t=xe();t.moveTo(1e3*e[0][0],1e3*e[0][1]);for(var r=1;r<e.length;r++)t.lineTo(1e3*e[r][0],1e3*e[r][1]);return t.toString()},we.prototype.visualizeVoronoi=function(e,t,r,n,i){var s=t.tris;void 0===i&&(i=K(r)+1e-9),void 0===n&&(n=J(r)-1e-9);var o=r.map((function(e){return e>i?1:e<n?0:(e-n)/(i-n)})),a=e.selectAll("path.field").data(s);a.enter().append("path").classed("field",!0),a.exit().remove(),e.selectAll("path.field").attr("d",this.makeD3Path).style("fill",(function(e,t){return ye(o[t])}))},we.prototype.drawPaths=function(e,t,r){(r=e.selectAll("path."+t).data(r)).enter().append("path").classed(t,!0),r.exit().remove(),e.selectAll("path."+t).attr("d",this.makeD3Path)},we.prototype.visualizeSlopes=function(e,t,r){for(var n=this.mesher,s=this.terrainGenerator,o=this.eroder,a=new i("vslopes"),h=r,f=[],l=.25/Math.sqrt(h.length),u=0;u<h.length;u++)if(!(h[u]<=0||n.isnearedge(t,u))){var c=n.neighboursCopy(t,u);c.push(u);for(var p=0,d=0,v=0;v<c.length;v++){var g=o.trislope(t,c[v]);p+=g[0]/10,d+=g[1]}if(p/=c.length,d/=c.length,!(Math.abs(p)<s.runif(.1,.4))){var m=l*s.runif(1,2)*(1-.2*Math.pow(Math.atan(p),2))*Math.exp(d/100),y=t.vxs[u][0],x=t.vxs[u][1];if(Math.abs(m*p)>2*l){var w=Math.floor(Math.abs(m*p/l));m/=w,w>4&&(w=4);for(var b=0;b<w;b++){var M=a.rnorm()*l,C=a.rnorm()*l;f.push([[y+M-m,x+C+m*p],[y+M+m,x+C-m*p]])}}else f.push([[y-m,x+m*p],[y+m,x-m*p]])}}var k=e.selectAll("line.slope").data(f);k.enter().append("line").classed("slope",!0),k.exit().remove(),e.selectAll("line.slope").attr("x1",(function(e){return 1e3*e[0][0]})).attr("y1",(function(e){return 1e3*e[0][1]})).attr("x2",(function(e){return 1e3*e[1][0]})).attr("y2",(function(e){return 1e3*e[1][1]}))},we.prototype.visualizeCities=function(e,t){var r=t.cities,n=t.mesh,i=t.params.nterrs,s=e.selectAll("circle.city").data(r);s.enter().append("circle").classed("city",!0),s.exit().remove(),e.selectAll("circle.city").attr("cx",(function(e){return 1e3*n.vxs[e][0]})).attr("cy",(function(e){return 1e3*n.vxs[e][1]})).attr("r",(function(e,t){return t>=i?4:10})).style("fill","white").style("stroke-width",5).style("stroke-linecap","round").style("stroke","black").raise()},we.prototype.drawMap=function(e,t){var r=this.mesher,n=this.cityPlacer,i=this.nameGiver;t.rivers=n.getRivers(t.mesh,.01),t.coasts=r.contour(t.mesh,0),t.terr=n.getTerritories(t),t.borders=n.getBorders(t),this.drawPaths(e,"river",t.rivers),this.drawPaths(e,"coast",t.coasts),this.drawPaths(e,"border",t.borders),this.visualizeSlopes(e,t.mesh,t.mesh.buffer),this.visualizeCities(e,t),i.giveNames(t),i.drawLabels(e,t)},we.prototype.addSVG=function(e){return e.insert("svg",":first-child").attr("height",400).attr("width",400).attr("viewBox","-500 -500 1000 1000")};var be=function(e){void 0===e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(var r=0;r<512;r++)this.perm[r]=this.p[255&r];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]],this.F2=.5*(Math.sqrt(3)-1),this.G2=(3-Math.sqrt(3))/6};be.prototype.dot=function(e,t,r){return e[0]*t+e[1]*r},be.prototype.dot3=function(e,t,r,n){return e[0]*t+e[1]*r+e[2]*n},be.prototype.dot4=function(e,t,r,n,i){return e[0]*t+e[1]*r+e[2]*n+e[3]*i},be.prototype.noise=function(e,t){var r,n,i=(e+t)*this.F2,s=Math.floor(e+i),o=Math.floor(t+i),a=this.G2,h=(s+o)*a,f=e-(s-h),l=t-(o-h);f>l?(r=1,n=0):(r=0,n=1);var u=f-r+a,c=l-n+a,p=f-1+2*a,d=l-1+2*a,v=255&s,g=255&o,m=this.perm,y=this.grad3,x=(m[v+r+m[g+n]],m[v+1+m[g+1]],.5-f*f-l*l),w=.5-u*u-c*c,b=.5-p*p-d*d;return 70*((x<0?0:(x*=x)*x*this.dot(y[m[v+m[g]]%12],f,l))+(w<0?0:(w*=w)*w*this.dot(y[m[v+r+m[g+n]]%12],u,c))+(b<0?0:(b*=b)*b*this.dot(y[m[v+1+m[g+1]]%12],p,d)))},be.prototype.noise3d=function(e,t,r){var n,i,s,o,a,h,f=(e+t+r)*(1/3),l=Math.floor(e+f),u=Math.floor(t+f),c=Math.floor(r+f),p=1/6,d=(l+u+c)*p,v=e-(l-d),g=t-(u-d),m=r-(c-d);v>=g?g>=m?(n=1,i=0,s=0,o=1,a=1,h=0):v>=m?(n=1,i=0,s=0,o=1,a=0,h=1):(n=0,i=0,s=1,o=1,a=0,h=1):g<m?(n=0,i=0,s=1,o=0,a=1,h=1):v<m?(n=0,i=1,s=0,o=0,a=1,h=1):(n=0,i=1,s=0,o=1,a=1,h=0);var y=v-n+p,x=g-i+p,w=m-s+p,b=v-o+2*p,M=g-a+2*p,C=m-h+2*p,k=v-1+.5,S=g-1+.5,T=m-1+.5,E=255&l,P=255&u,R=255&c,A=this.perm[E+this.perm[P+this.perm[R]]]%12,B=this.perm[E+n+this.perm[P+i+this.perm[R+s]]]%12,I=this.perm[E+o+this.perm[P+a+this.perm[R+h]]]%12,L=this.perm[E+1+this.perm[P+1+this.perm[R+1]]]%12,N=.6-v*v-g*g-m*m,z=.6-y*y-x*x-w*w,G=.6-b*b-M*M-C*C,F=.6-k*k-S*S-T*T;return 32*((N<0?0:(N*=N)*N*this.dot3(this.grad3[A],v,g,m))+(z<0?0:(z*=z)*z*this.dot3(this.grad3[B],y,x,w))+(G<0?0:(G*=G)*G*this.dot3(this.grad3[I],b,M,C))+(F<0?0:(F*=F)*F*this.dot3(this.grad3[L],k,S,T)))};var Me=function(e){this.r=e,this.r||(this.r=Math),this.p=[];for(var t=0;t<256;t++)this.p[t]=Math.floor(256*this.r.random());this.perm=[];for(var r=0;r<512;r++)this.perm[r]=this.p[255&r];this.dirs=[];for(var n=2*Math.PI/256,i=0;i<256;i++)this.dirs[i]=[Math.cos(i*n),Math.sin(i*n)]};Me.prototype.surflet=function(e,t,r,n,i){var s=Math.abs(e-r),o=Math.abs(t-n),a=1-s*s*s*(s*(6*s-15)+10),h=1-o*o*o*(o*(6*o-15)+10),f=this.perm,l=this.dirs,u=f[(f[r%i]+n)%i];return l[u],a*h*((e-r)*l[u][0]+(t-n)*l[u][1])},Me.prototype.noise=function(e,t,r){var n=e>>0,i=t>>0,s=0;return s+=this.surflet(e,t,n,i,r),s+=this.surflet(e,t,n+1,i,r),(s+=this.surflet(e,t,n,i+1,r))+this.surflet(e,t,n+1,i+1,r)},Me.prototype.sumOctaves=function(e,t,r,n){for(var i=0,s=32,o=0;o<r;++o)i+=1/s*this.noise(e*s,t*s,n*s),s*=2;return i};var Ce=Object.freeze({NO_TREES:0,LIGHT:1,DENSE:2,FULL:3}),ke=function(e){this.dimension=e||512,this.chunkHeight=16,this.chunkWidth=16,this.heightBuffer=[],this.surfaceBuffer=[],this.treeDensities=[],this.rng2=null,this.noiseTile=[],this.noiseTileDimension=256,this.noiseTileReady=!1,this.rng=new i("simplex"),this.tpng=new Me(this.rng),this.zBuffer=[],this.zPassBuffer=[],this.step=-1,this.currentTriangle=0,this.heightPassDone=!1};ke.prototype.setNoiseTile=function(e){var t=this.noiseTileDimension;if(e.length!==t*t)throw Error("[Rasterizer] Noise tile dimension mismatch.");if(!(e instanceof Float32Array))throw Error("[Rasterizer] Noise tile type mismatch.");this.noiseTile=e,this.noiseTileReady=!0},ke.prototype.resetBuffers=function(e){this.zBuffer.length!==e?this.zBuffer=new Float64Array(e):this.zBuffer.fill(0),this.zPassBuffer.length!==e?this.zPassBuffer=new Uint8Array(e):this.zPassBuffer.fill(0)},ke.prototype.computeTriMesh=function(e,t){var r=e.tris,n=e.triPointIndexes,i=t.buffer,s=(e.nbInteriorTris,[]);this.resetBuffers(e.nbTriPointIndexes);for(var o=this.zBuffer,a=this.zPassBuffer,h=0;h<r.length;++h){var f=r[h],l=i[h];if(3===f.length)for(var u=n[h],c=0;c<3;++c){var p=u[c];if(o[p]){var d=o[p];Math.sign(l)!==Math.sign(d)?(o[p]=Math.min(d,l),a[p]=1):(o[p]=d+l,a[p]+=1)}else o[p]=l,a[p]=1;o[p]+=l,a[p]++}}for(var v=0;v<r.length;++v){var g=r[v];if(3===g.length){for(var m=n[v],y=[],x=0;x<3;++x){var w=g[x],b=w[0],M=w[1],C=m[x],k=o[C]/a[C];y.push([b,M,k])}s.push(y)}}return s},ke.prototype.putPixel=function(e,t,r){this.surfaceBuffer[t*this.dimension+e]=r},ke.prototype.drawCircle=function(e,t,r){var n,i,s;for(n=0,i=r,s=r-1;i>=n;)this.putPixel(e+n,t+i,2),this.putPixel(e+i,t+n,2),this.putPixel(e-n,t+i,2),this.putPixel(e-i,t+n,2),this.putPixel(e+n,t-i,2),this.putPixel(e+i,t-n,2),this.putPixel(e-n,t-i,2),this.putPixel(e-i,t-n,2),s>=2*n?(s-=2*n+1,++n):s<2*(r-i)?(s+=2*i-1,--i):(s+=2*(i-n-1),--i,++n)},ke.prototype.drawTriangle=function(e,t,r,n,i,s,o,a,h){for(var f=Math.min(e,n,o),l=Math.max(e,n,o),u=Math.min(t,i,a),c=Math.max(t,i,a),p=t-i,d=n-e,v=e*i-n*t,g=i-a,m=o-n,y=n*a-o*i,x=a-t,w=e-o,b=o*t-e*a,M=Math.floor(u),C=Math.floor(f),k=Math.ceil(c),S=Math.ceil(l),T=g*e+m*t+y,E=x*n+w*i+b,P=p*o+d*a+v,R=this.dimension,A=this.heightBuffer,B=M;B<=k;++B)for(var I=R*B,L=C;L<=S;++L){var N=(g*L+m*B+y)/T,z=(x*L+w*B+b)/E,G=(p*L+d*B+v)/P;N>0&&z>0&&G>0&&(A[I+L]=255*(N*r+z*s+G*h))}},ke.prototype.initBuffers=function(){var e=this.dimension,t=this.dimension;this.heightBuffer=new Int32Array(e*t),this.surfaceBuffer=new Uint8Array(e*t)},ke.prototype.heightPass=function(e){for(var t=this.dimension,r=this.dimension,n=window.performance.now(),i=e.length,s=this.currentTriangle,o=s;o<i;++o){var a=e[o];if(3===a.length){if(this.drawTriangle((.5+a[0][0])*t-.5,(.5+a[0][1])*r-.5,a[0][2],(.5+a[1][0])*t-.5,(.5+a[1][1])*r-.5,a[1][2],(.5+a[2][0])*t-.5,(.5+a[2][1])*r-.5,a[2][2]),o===i-1)return this.heightPassDone=!0,void(this.currentTriangle=0);var h=window.performance.now();if(o-s>1e3&&h-n>5)return void(this.currentTriangle=o+1)}}},ke.prototype.precomputeNoiseTile=function(e){var t=this.noiseTileDimension,r=this.noiseTileDimension,n=this.tpng;this.noiseTile=new Float32Array(r*t);for(var i=this.noiseTile,s=1/256,o=r*s>>0,a=0;a<t;++a)for(var h=r*a,f=0;f<r;++f)i[h+f]=n.sumOctaves(f*s,a*s,e,o);for(var l=1/0,u=-1/0,c=0;c<i.length;++c){var p=i[c];p>u&&(u=p),p<l&&(l=p)}for(var d=u-l,v=0;v<i.length;++v)i[v]=(i[v]-l)/d;this.noiseTileReady=!0},ke.prototype.noisePass=function(e){if(this.noiseTileReady||this.precomputeNoiseTile(5),this.dimension%this.noiseTileDimension!=0)throw Error("Map dimension must be a multiple of the noise kernel dimension.");for(var t=this.heightBuffer,r=this.noiseTile,n=this.dimension,i=this.noiseTileDimension,s=this.dimension,o=this.noiseTileDimension,a=0;a<n;++a)for(var h=s*a,f=o*(a%i),l=0;l<s;++l){var u=t[h+l];u<0||(t[h+l]=u-e*r[f+l%o])}},ke.prototype.riverPass=function(e){for(var t=this.dimension,r=this.dimension,n=e.length,i=0;i<n;++i)for(var s=e[i],o=s.length-1,a=0;a<o;++a){var h=s[a],f=s[a+1],l=(.5+h[0])*t,u=(.5+h[1])*r,c=(.5+f[0])*t,p=(.5+f[1])*r,d=c-l,v=p-u,g=Math.sqrt(d*d+v*v),m=4*d/g,y=4*v/g,x=-m,w=-y,b=m,M=y+l,C=x+u,k=y+c,S=x+p;this.drawTriangle(l,u,-10,c,p,-10,M,C,0),this.drawTriangle(c,p,-10,M,C,0,k,S,0);var T=w+l,E=b+u,P=w+c,R=b+p;this.drawTriangle(l,u,-10,c,p,-10,T,E,0),this.drawTriangle(c,p,-10,T,E,0,P,R,0)}},ke.prototype.drawCity=function(e,t,r){this.drawCircle(e,t,r),this.drawCircle(e,t,r-1),this.drawCircle(e,t,r-2)},ke.prototype.cityPass=function(e,t){for(var r=t.length,n=this.dimension,i=this.dimension,s=e.tris,o=0;o<r;++o){var a=s[t[o]],h=0,f=0,l=a.length;2!==l&&3!==l&&console.warn("Uncommon tri length: ".concat(l,"."));for(var u=0;u<l;++u)h+=a[u][0],f+=a[u][1];var c=o<5?30:15,p=(.5+(h/=l))*n-.5>>0,d=(.5+(f/=l))*i-.5>>0;this.drawCity(p,d,c)}},ke.prototype.seedChunkRandom=function(e){this.rng2=new i(e)},ke.prototype.computeChunkTreeDensity=function(){var e=this.dimension/this.chunkHeight*(this.dimension/this.chunkWidth);this.treeDensities=new Uint8Array(e);for(var t=this.treeDensities,r=this.rng2,n=0;n<e;++n){var i=r.uniform();t[n]=i>.99?Ce.FULL:i>.9?Ce.DENSE:i>.5?Ce.LIGHT:Ce.NONE}},ke.prototype.fillTrees=function(e,t,r){for(var n=this.chunkHeight,i=this.chunkWidth,s=e*n,o=t*i,a=this.dimension,h=this.rng2,f=this.surfaceBuffer,l=0;l<r;++l)f[(s+Math.floor(1+h.uniform()*(i-1)))*a+(o+Math.floor(1+h.uniform()*(n-1)))]=1},ke.prototype.treePass=function(){for(var e=this.dimension/16,t=this.dimension/16,r=this.treeDensities,n=0,i=0;i<t;++i)for(var s=0;s<e;++s){switch(r[n]){case Ce.NONE:break;case Ce.FULL:this.fillTrees(s,i,15);break;case Ce.DENSE:this.fillTrees(s,i,5);break;case Ce.LIGHT:this.fillTrees(s,i,2)}++n}};var Se=Object.freeze({WAITING:-1,START:0,HEIGHTMAP_INIT:1,HEIGHTMAP_MOUNTAINS:2,HEIGHTMAP_RELAX:3,HEIGHTMAP_EROSION:4,HEIGHTMAP_LEVEL:5,HEIGHTMAP_CLEAN:6,OBJECTS_RIVERS:7,OBJECTS_CITIES:8,OBJECTS_BIOMES:9,RASTER_TRIMESH:10,RASTER_RASTERIZE:11,RASTER_NOISE_PASS:12,RASTER_RIVER_PASS:13,RASTER_TREE_PASS:14,RASTER_CITY_PASS:15,READY:16}),Te=function(e,t,r,n){this.coordX=e,this.coordY=t,this.dimension=r,this.country=n,this.buffer=new Float64Array(n.mesh.tris.length);var i="a".concat(e,",").concat(t);this.tileSeed=i,this.rasterizer=new ke(this.dimension),this.mesher=new W,this.fieldModifier=new Z(this.mesher,i),this.eroder=new Q(this.mesher),this.cityPlacer=new re(this.mesher,this.fieldModifier,this.eroder),this.terrainGenerator=new s(this.mesher,this.fieldModifier,this.eroder,i),this.languageGenerator=new ne(i),this.nameGiver=new de(this.languageGenerator),this.step=Se.WAITING,this.ready=!1,this.presentInScene=!1};function Ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Te.prototype.setNoiseTile=function(e){this.rasterizer.setNoiseTile(e)},Te.prototype.stepGeneration=function(){if(!this.ready){var e=this.country.mesh,t=this.fieldModifier,r=this.terrainGenerator,n=this.eroder,i=this.country,s=this.cityPlacer,o=this.rasterizer;switch(this.step){case Se.WAITING:this.step++;break;case Se.START:var a=e.tris.length;this.fieldModifier.resetBuffer(a),this.fieldModifier.swapBuffers(this),this.fieldModifier.resetBuffer(a),this.step++;break;case Se.HEIGHTMAP_INIT:t.addCone(e,this.buffer,-1),t.addSlope(e,this.buffer,this.coordX,this.coordY),this.step++;break;case Se.HEIGHTMAP_MOUNTAINS:t.addMountains(e,this.buffer,5),t.nbMountains>=50&&this.step++;break;case Se.HEIGHTMAP_RELAX:for(var h=0;h<10;h++)t.relax(e,this);t.peaky(e,this.buffer);var f=r.runif(.04,.1);n.setErosionAmount(f),this.step++;break;case Se.HEIGHTMAP_EROSION:n.stepErosion(e,this,5),n.ready&&this.step++;break;case Se.HEIGHTMAP_LEVEL:var l=r.runif(.2,.6);t.setSeaLevel(e,this.buffer,l),this.step++;break;case Se.HEIGHTMAP_CLEAN:n.cleanCoast(e,this),n.cleanCoastPass>=3&&this.step++;break;case Se.OBJECTS_RIVERS:i.rivers=s.getRivers(i.mesh,this,.01),this.step++;break;case Se.OBJECTS_CITIES:s.placeCities(i,this,3),s.nbCities>=i.params.ncities&&this.step++;break;case Se.OBJECTS_BIOMES:o.seedChunkRandom(this.tileSeed),o.computeChunkTreeDensity(),this.step++;break;case Se.RASTER_TRIMESH:var u=o.computeTriMesh(i.mesh,this);this.triMesh=u,o.initBuffers(),this.step++;break;case Se.RASTER_RASTERIZE:o.heightPass(this.triMesh),o.heightPassDone&&this.step++;break;case Se.RASTER_NOISE_PASS:o.noisePass(5),this.step++;break;case Se.RASTER_RIVER_PASS:o.riverPass(i.rivers),this.step++;break;case Se.RASTER_TREE_PASS:o.treePass(),this.step++;break;case Se.RASTER_CITY_PASS:o.cityPass(i.mesh,i.cities),this.step++;break;case Se.READY:this.ready=!0}}},Te.prototype.processHeightMap=function(){var e=this.fieldModifier,t=this.country.mesh,r=this.eroder,n=this.terrainGenerator;e.resetBuffer(t.tris.length),e.addSlope(t,n.randomVector(4)),e.addCone(t,n.runif(-1,-1)),e.addMountains(t,50);for(var i=0;i<10;i++)e.relax(t);e.peaky(t);var s=n.runif(0,.1);r.doErosion(t,s,5);var o=n.runif(.2,.6);e.setSeaLevel(t,o),r.fillSinks(t),r.cleanCoast(t,3)},Te.prototype.placeObjects=function(){var e=this.country,t=this.cityPlacer,r=this.mesher;t.placeCities(e),e.rivers=t.getRivers(e.mesh,.01),e.coasts=r.contour(e.mesh,0),e.terr=t.getTerritories(e),e.borders=t.getBorders(e)},Te.prototype.renderToRaster=function(){var e=this.rasterizer,t=this.country,r=e.computeTriMesh(t.mesh);this.triMesh=r,e.initBuffers(r),e.heightPass(r),e.noisePass(5),console.log(e.heightBuffer),e.riverPass(t.rivers),e.cityPass(t.mesh,t.cities)},Te.prototype.getRaster=function(){return this.rasterizer.heightBuffer},Te.prototype.getSurfaceRaster=function(){return this.rasterizer.surfaceBuffer},Te.prototype.getCountry=function(){return this.country};var Pe=function(){this.tiles=new Map,this.tileDimension=1024,this.mesher=new W,this.mesh=null,this.rasterizer=new ke(this.tileDimension),this.noiseTile=null,this.DEBUG_THREE=!1};Pe.prototype.seedWorld=function(e){var t=this.mesher.generateGoodMesh(16384,{width:1,height:1});console.log(t),this.mesh=t;var r=this.rasterizer;r.precomputeNoiseTile(5),this.noiseTile=r.noiseTile},Pe.prototype.stepTileGeneration=function(e){return e.ready||e.stepGeneration(),e.ready},Pe.prototype.loadTile=function(e,t){var r={params:a,mesh:this.mesh},n=new Te(e,t,this.tileDimension,r);n.setNoiseTile(this.noiseTile),n.processHeightMap(),n.placeObjects(),n.renderToRaster(),this.tiles.set("".concat(e,",").concat(t),n)},Pe.prototype.generateIfNeeded=function(e,t){var r=t.position,n=r.x,i=r.y,s=Math.round(n),o=Math.round(i),h="".concat(s,",").concat(o),f=this.tiles.get(h);if(f)if(f.ready){if(!f.presentInScene)if(f.presentInScene=!0,f.p)e.add(f.p);else{var l=this.makeImageBufferFromRaster(f,f.getRaster(),f.getSurfaceRaster()),u=this.addThreeMesh(e,f.getCountry(),f.triMesh,f.dimension,f.dimension,l,f.coordX,f.coordY);f.p=u}}else f.stepGeneration();else(f=new Te(s,o,this.tileDimension,{params:a,mesh:this.mesh})).setNoiseTile(this.noiseTile),this.tiles.set(h,f);this.tiles.forEach((function(e,t){e.presentInScene&&t!=="".concat(s,",").concat(o)&&e.p}))},Pe.prototype.getTiles=function(){return this.tiles},Pe.prototype.makeImageBufferFromRaster=function(e,t,r){for(var n=e.dimension,i=e.dimension,s=t,o=r,a=new Uint8ClampedArray(n*i*4),h=0;h<i;++h)for(var f=0;f<n;++f){var l=4*(h*n+f),u=(n-h-1)*n+f,c=s[u]>>0,p=o[u]>>0;c>0?(a[l]=p<1?c:255,a[l+1]=p<1?c:0,a[l+2]=p<1?c:0):(a[l]=0,a[l+1]=0,a[l+2]=255),a[l+3]=255}return a},Pe.prototype.addThreeMesh=function(e,t,r,i,s,o,a,h){function f(e){e.position.x=a,e.position.y=h}for(var l=function(e){if(Array.isArray(e))return Ee(e)}(y=t.rivers)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(y)||function(e,t){if(e){if("string"==typeof e)return Ee(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ee(e,t):void 0}}(y)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),u=0;u<l.length;++u){for(var c=l[u],p=new n.nls({color:16711680}),d=[],v=0;v<c.length;++v){var g=c[v];d.push(new n.Pa4(g[0],g[1],.1))}var m=(new n.u9r).setFromPoints(d);f(new n.x12(m,p))}for(var y,x=new n.u9r,w=new Float32Array(3*r.length*3),b=0;b<r.length;++b){var M=r[b];w[9*b]=M[0][0],w[9*b+1]=M[0][1],w[9*b+2]=M[0][2]/4,w[9*b+3]=M[1][0],w[9*b+4]=M[1][1],w[9*b+5]=M[1][2]/4,w[9*b+6]=M[2][0],w[9*b+7]=M[2][1],w[9*b+8]=M[2][2]/4}var C=new n.TlE(w,3);x.setAttribute("position",C),x.computeVertexNormals();var k=new n.xoR({color:65280,side:n.ehD,shininess:0}),S=new n.Kj0(x,k);f(S),this.DEBUG_THREE&&e.add(S);var T=new n.IEO(o,i,s,n.wk1),E=new n.Kj0(new n.BKK(1,1),new n.vBJ({transparent:!0,opacity:.5,map:T}));return E.scale.y=-1,E.position.set(0,0,0),f(E),e.add(E),E};var Re=new W,Ae=new Z(Re),Be=new Q(Re),Ie=new re(Re,Ae,Be),Le=new s(Re,Ae,Be),Ne=new ne,ze=new de(Ne);ge.Ys,new we(Re,Be,Le,Ie,ze),function(){var e=document.getElementById("gl"),t=window.devicePixelRatio,r=e.clientWidth*t,i=e.clientHeight*t,s=new n.xsS,o=new n.cPb(75,r/i,.1,1e3),a=new n.CP7({antialias:!0});a.setSize(r,i),e.appendChild(a.domElement);var h=new n.Ox3(16777215,2);h.position.set(1,-1,2),s.add(h),o.position.z=1;var f=new ve.o(o,e);f.enableRotate=!1,f.screenSpacePanning=!0;var l=new Pe;l.seedWorld(),function e(){requestAnimationFrame(e),l.generateIfNeeded(s,o),a.render(s,o)}()}()},426:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var n=r(645),i=r.n(n)()((function(e){return e[1]}));i.push([e.id,'\n#gen-image {\n    z-index: 4;\n}\n\n#gl {\n    width: 1000px;\n    height: 500px;\n    z-index: 3;\n}\n\nbody {\n    font-family: Raleway, sans-serif;\n    background-color: #eee;\n    display: flex;\n    flex-direction: column;\n}\n\ndiv#header {\n    font-size: 2rem;\n    text-align: right;\n    margin-bottom: 1rem;\n}\ndiv#container {\n    display: flex;\n    flex-direction: row;\n}\ndiv#menu {\n    height: 100%;\n    flex: 0 1 15rem;\n}\n\ndiv#content {\n    flex: 1;\n    display: flex;\n    flex-direction: row;\n    flex-wrap: wrap;\n}\n\ndiv#menu ul {\n    list-style-type: none;\n    font-size: 2rem;\n    margin: 0;\n    padding: 0;\n}\n\ndiv.project-icon {\n    flex: 0 1 33%;\n    text-align: center;\n    margin-bottom: 1em;\n}\ndiv.project, div.note, div.books {\n    padding: 1em 2em 1em 2em;\n    width: 100%;\n    clear: both;\n    overflow: auto;\n    background-color: white;\n}\n\ndiv.note h1 {\n    margin: 0;\n    padding: 0;\n    font-size: 3rem;\n    text-align: center;\n}\n\nh2 {\n    font-size: 2rem;\n    padding: 0;\n    margin: 0;\n}\nh3 {\n    font-size: 1.5rem;\n}\np.medium {\n    font-size: 1rem;\n    font-style: italic;\n}\ndiv.example-tweets, div.example-images {\n    float: right;\n    width: 400px;\n    margin-left: 1em;\n}\n\ndiv.example {\n    margin: 0.5em;\n    padding: 1em;\n    background-color: #eee;\n    clear: both;\n    overflow: auto;\n}\n\ndiv.controlset {\n    overflow: auto;\n}\ndiv.control {\n    padding: 0.5em;\n    float: left;\n}\n\ndiv.output {\n    padding: 0.5em;\n    clear: both;\n}\n\ndiv.book {\n    padding-top: 1em;\n}\n\n.book .title {\n    font-weight: bold;\n    font-size: 1.5rem;\n}\n\n.book  .author {\n    font-style: italic;\n    font-size: 1.5rem;\n}\ndiv#footer {\n    clear: both;\n    font-size: small;\n    text-align: center;\n}\n\nbutton {\n    font-size: large;\n    background-color: white;\n    color: black;\n    border-radius: 0.5rem;\n    border: 1px solid black;\n    margin-right: 0.5rem;\n    margin-bottom: 0.5rem;\n}\n\nbutton:hover {\n    background-color: black;\n    color: white;\n}\n\n\nselect {\n    background-color: white;\n    border: solid 1px black;\n    font-size: medium;\n    margin-left: 0.5rem;\n}\n\nfigcaption {\n    text-align: center;\n}\n\npath, line {\n    fill: none;\n    stroke: black;\n    stroke-linecap: round;\n}\n\n.field {\n    stroke: none;\n    fill-opacity: 1.0;\n}\n\n.slope {\n    stroke-width: 1;\n}\n\n.river {\n    stroke-width: 2;\n}\n\n.coast {\n    stroke-width: 4;\n}\n\n.border {\n    stroke-width: 5;\n    stroke-dasharray: 4,4;\n    stroke-linecap: butt;\n}\n\ntext {\n    font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif;\n    color: black;\n    stroke: white;\n    stroke-width: 5;\n    stroke-linejoin: round;\n    paint-order: stroke;\n}\n\ntext.region {\n    stroke-width:10;\n    font-variant: small-caps;\n}\n\nsvg {\n    float: right;\n    background-color: white;\n}\n',""]);const s=i},654:(e,t,r)=>{"use strict";var n=r(379),i=r.n(n),s=r(426),o=i()(s.default,{insert:"head",singleton:!1});if(!s.default.locals||e.hot.invalidate){var a=s.default.locals;e.hot.accept(426,(t=>{s=r(426),function(e,t,r){if(!e&&t||e&&!t)return!1;var n;for(n in e)if(e[n]!==t[n])return!1;for(n in t)if(!e[n])return!1;return!0}(a,s.default.locals)?(a=s.default.locals,o(s.default)):e.hot.invalidate()}))}e.hot.dispose((function(){o()})),s.default.locals}},0,[[212,666,216]]]);